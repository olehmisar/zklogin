import { type SignerWithAddress } from "@nomicfoundation/hardhat-ethers/signers";
import { ethers } from "hardhat";
import { describe } from "mocha";
import { snapshottedBeforeEach } from "../shared/utils";
import {
  TestJwtAccount__factory,
  UltraVerifier__factory,
} from "../typechain-types";

describe("JwtAccount", () => {
  let alice: SignerWithAddress;

  snapshottedBeforeEach(async () => {
    [alice] = await ethers.getSigners();
  });

  it("works", async () => {
    const verifier = await new UltraVerifier__factory(alice).deploy();
    const proof =
      "0x1fc3bfc4b89ee894ee6880df3c2e1b3e43a45455ad363e3dd36079df2adb3ed12a5fed459cf01fca74f8403554cebc3e7d48a6b121b73ce0ebe5d334ce8056e308be42abf787f0bf5d5e3aaf1746562b126f463e374a1d93a018069f310f5e1c08bf9e9b935b12ddcf497439e3cd4904fe6434ff79f2345cc7777f08d52e2ddb128c307da069afd94f09fe5cf16dbddd3894b874f5135ff63c856948f3093f4e2da2bc4ddaffd1b5146e0c9b542c570bbef596da53030c031570009f30a189072c3ebe56c7bbaed51988897cba0b6af869e236c9f3e5587351443c22e43d02ae2a9a9ffde917b085c16c305b18d48db645485b4601d9e7ca67d9159a89f586d7140280f68f94be6194479feca89785838e20c58e3944b68505411bd7e636a0dd17e02a9ea529589841e2ec093497d97589a6becf7e2ef764038950aa1fb4be072da2cbbc3a92d85f974e8674e59589fb044786b857622397afcaf2055c381c170a16b64b45d5a6edd1598022f029a368296c344a3407441b58fc33bef6f243f42ff0d0c4b230752791cfb3476106054c46630ec2d02f348b118f407394e004621370bdbeddf9de5bfe2f18b0d18b13785b4801b4bf82d97238e772ca49adf23e2040e1400f5c314722ced1c513e75e3b714889a09a4b436d6316cc5873e5bf620ed4e58f5ea36c4451f06f5bf1345c82f3c0c32f9acb505519841ecb2714b9c0247209c44f73df8fdcfba7fa037a68d4ae8c1406790f18be49c0cf52e42bf52e0a08a8542cf7ba7b44b8b9187a86d4a07fc749e95c01db25770e89970463663907e428946f47cf2da997ca0f31b840396b2b658428ec316ffa8f10959edb2dca05c82bfef742c0b8e6b78b1abc8c89f862fb572dccd664165f9753b6f4f89ec30a6398a29ef7b086c7f5a539cc7b7d2036f09e09dad5bbb8ada31376cad2bd31077a6fc242c7a5d50883f4c9cb8e4b619296f177c1d034bbbe83bd56bd15a06a09e59f061880e8c33745ff5daa9e760edb4a062ea8c9cf84eb84ef0f062298bc0aeff26a7628ebf1ee9843b9d223cf500c6ec149e2f2e62fc9b4bcccf49d3c07231cce0abb6fdbf71ec3dea2a1acecc7ca7324f6582adbdb384ca13f413bb5db012cca0935729415b343f0543c8f08de53fc6af89efde9911b17d9939c5c82521b596cef56138df605cd7a5784a790026b2f917d4a219139f30073e2e0cf03f31f1c71f9e5252fb905aca397cf6ea10e8dcde284fefb30c62c5978ed5dbe1cee03930dd86f2eb58633773b9b1df6027c97eebc5c94047841fdd7ecba9b4d78ef00ea289940a50b783123db4bae876098a05483daac3203d466a3959604ea60ae2ce59f393461df762d5f147e3f16a0c8bae8dbf8541a41430e9ca050becb17b120c0b1aa6622a30e53b5d14050d95d48109787ba486e2fa0cbe3bd112907116c21363a942d01dd6ecb4282108aab2722ee6777ae965f61b0931031312ac1777b0c681ab725d8698e08e305d1a27085c68a23fd9df7925d287e2cb1878ad2f6e220d5ad2e1045038eff7146c3565d4bebde5aab0a07ed045da52bd1378319ded22133e22efebcc6501f1de79fb43c2401c77066bdd6e81dd8d6bdf4735085dfe21be16da2670e1fc937be55d39360901a503c31c0941e0cc8feea7c74fe389ac513986d3d88625d4c451051c8b445243175c2c263f7e922b94eabca06c20e729c0d381db2e0939400de000acfc687598eb144f72e96b91a335fe5c24a74ed4fd61b51b2a883cbcaf458efc7068c3681e221c524f6f6dcd195d9a49a6075596e850a6751525c5e20e5ded213d4eeec0acb79b59ac47d1c7f86354c9d3c9e5098fa02510af5c3fb1c1915c04c5a7a45cce4431cd6a4c6e5586671198c5bf9c2a123257cbb864f83f60ede9b7f0c72079beb9f1944dc9d7e18a91f171bc20f87eeb62c094bb329933d384ccf2799de0ffbd4f16a536279fa1fd170427aa197495dd8202ae655fe5b20c620ff5337fd30346012047de8de56364e6b3b043e93c8fec50cf017c4910a0020100f0480cc030dd2708420e176a3584d10513dd775efc1e31984a8ad2a77e89c5d6179f38aeae1ba49f09df7c6ea06462bd46427ed14eac2118b82bd5f42329b35e2b7c7b9e058d52c78a6ba5e5e11cbb0a7eb3e414aec75046a19fd9ddc12f66e233d5afe1f8fe034feb525e0e005bcaeafdf581e1edc762c97b872c704c5d8c97a83a54af1b79d67391debababa19899fcb3cf78e3ac8324cdb7a8ee6c4ecacb395fe7ffba9a9f17f50d9dc1694466c205eec1696a415619c5f275790a94249d34849e9664fd9f78f43b3a4fd46376592a794c666b0f590baf62265151917a77cdefcef645d73c01fd6538d539e643ac8ed6c49e370cf610d6a42b5d880d0af78423a2a7d305090cad27b598403a4cf40032de063c82061c695a13fa0875cc86b537126a40a6560cd8c322af77676771b1ff498c91cc9907ea0609f90f093a39082d22c8c39562b61d9d1102ff86c46d89b46d29fdff38244dd8264c69467816e4eacb5c905a89eaa7c3cc77943b45e0f52c732e5f651a0b521533c20fdc21be07e604bdeeab40a934309615bc67e6aba2b549587dbe3d2c29578096799cd2bf5064a429c7d788eb335411cfb935a0c8ff60890dde7b5a26471434cac6d5984c3fdad96f41f3cbc14d942304b8e0ff6e374befbd6d80f518ee4384e92192d643293f64e4db8cb76144aaa38fd8b12dba46047594a7211f1b98eb771c1d32289c16357d604b4be3c02523131e30b0b42f6adb558138464b1a0d463d198f1d43661e1acd91bcdaa5f87c6ec2ba5733683886af6d0a15591d14673fe8df8ff7b1de26a442efd9dd2e2dc6184e4dbabe739078849e9784dd561c3dbf4b3b0025e8de98335c0c7867d44bf688b9d25052d88eb5d37bb0d513441adef4f57df60a37eb45bcdfc2c1e57268cc4b1eaf4babb2979a13947dce8b3c144a8bd9b0e8719711c38821cf1f3c9bbf8b130616900f5e76b89e04b88e65aa";
    const publicKey = {
      public_key_limbs: [
        "0x9d9b7ab520532396758488b2100155",
        "0x87ff0f733247ea1ae377d26bdd60aa",
        "0x55e1805ec2babe74ebadb5de3c29a7",
        "0x4131e289b5519e562dff8935a669e2",
        "0xe974f2f0179abc0cc837efb26a9d5d",
        "0x72f158dfb2a2ba0fd881d8742426ec",
        "0x7e56e9182ef83caea0a45cfdaba45a",
        "0xc2b9b23f6684f0442257dbb8a37291",
        "0xfc0ecae4fe9f8be5c52a91edd59db2",
        "0x3ba9bd0376ade89881c7bafa2b36de",
        "0x3548bec7032b97739300f7fd72769b",
        "0x6a5b4b975ccf938c5e63ee41d57c7c",
        "0x4fabc9dbb6a9157f91a87adaff6e66",
        "0x303d705edf9cae022cd91f57f332b6",
        "0x1834cc2b65d9d2cab6dd210ba58cad",
        "0x43b9c3ca0df606d243d4c442794829",
        "0x5239e9f174adc5871d580714b1eb98",
        "0xe1",
      ],
      public_key_redc_limbs: [
        "0x1e7578875458139006e47aac5c17fb",
        "0x249a5affa65fe288cb0df8ab6548be",
        "0xc29ec9b115f3132ff5fb71e744fba3",
        "0xbde4d1e1b2e894dd482277dc14aba5",
        "0x675f382edc2e53fabb2c785f0dd7e8",
        "0x8af86434e50f50ddfc9b46ce2c8990",
        "0xbaf8f36a4caec8a61d14be456599d3",
        "0x4ac14c9865afb8da5ab36b76e6d651",
        "0x2be72e03504024bbc777e0a1e9d16d",
        "0x249a0c4d673705ab5ad1757a225fea",
        "0x0300712f5005899fffeb1289f9ef4b",
        "0x73eb759f585e597acb40bfbf59efed",
        "0xe070a169f35358c7ead1df56d02d4b",
        "0x5657e0c005b6bca107abd9024b4dd1",
        "0xe6da2103c7938911ca44a5e641c541",
        "0xc98e9e1235394e0eb2b87143fd42c3",
        "0xdb1c76abaf095069edf0ea5248ef95",
        "0x0122",
      ],
    };
    const accountId =
      "0x295d04c5c1b26064172f268e6403c1fd1766274e7165ce21684f73b0f76f14b8";
    const jwtIat = 1729194717;
    const jwtAud =
      "698109474805-nvfg9hh31kjmb6mmn51d4oiombgr3s3v.apps.googleusercontent.com".padEnd(
        256,
        String.fromCharCode(0),
      );

    const account = await new TestJwtAccount__factory(alice).deploy(
      accountId,
      publicKey.public_key_limbs,
      publicKey.public_key_redc_limbs,
      verifier,
    );

    const tx = await account.verify({ proof, jwtIat, jwtAud });
    const receipt = await tx.wait();
    console.log("gas used", receipt?.gasUsed);
  });
});
