import { type SignerWithAddress } from "@nomicfoundation/hardhat-ethers/signers";
import { ethers } from "hardhat";
import { describe } from "mocha";
import { snapshottedBeforeEach } from "../shared/utils";
import {
  TestJwtAccount__factory,
  UltraVerifier__factory,
} from "../typechain-types";

describe("JwtAccount", () => {
  let alice: SignerWithAddress;

  snapshottedBeforeEach(async () => {
    [alice] = await ethers.getSigners();
  });

  it("works", async () => {
    const verifier = await new UltraVerifier__factory(alice).deploy();
    const proof =
      "0x04d3505724210896d93e32ba0d574c14f0cab2431011585dc8af624f7e26c0de09c161118c5d6e787fa52b7364bb4d35d62e0f484847a39e9bc50e97f2fbeeef2bc70fa848e164bdbb2fd84e31c7a1cb9f2969d4f65d5a7225f8950306fe4c1d0036278420a6023c81a489f7373e7ddb85a7c08f49cc5a9fb1010fb6e31d428b0a21cc3de0de13fe1051bef8946bbd173e1a305fe49d0041db67d3abc7565efe19cec4a0243bd9ef38df214bb676f3a272d824f64def21dc06530ae4008c0fbe221fd99fe20bafaccf4f87752926860c11e71e34e66235aa42e4309def407ba61d64bc31aa2d8b8ce5add253a588f52f72b275d4d2d930b5b9bf60d78f1202c708732565db6cbe5a0f78183b3c01975ef585e4d22b2003a65f393bac61665a0928c942194ed417bfd57e731a457c1505fa521aac4aed08fcc363cc07cc5da93128e731eec75c8449aae7972c8f965751b1ad4776571e07e9a2e3605ad2f293a8100b0a21577b07da0e414419f0d6b7d3cc6d1230d6845ee8bfa5fb96e031f2370ea352796eb29c4baa67a104d0a0802cbeead8df43b24e1134a71f5a8bd89da82e9aeeb714a5bd08fd94b3d558d98fc9d9a1a716ce68f1f3d3c6b835565aa4dd3027e9fc240ed7251edba1b43e56d7edd2be4dc630527b34813b46ec067841d420eb7e3b035f19586aa79436601d25759de95d4a421ddec452a216b79f78813e0496feb9445c044d6096b2e295f8a9f8d5691c2e699ecff05cb08f5075313c5f005f6ebbb317dc0563f1b61d3d27364b4756835b73ea98cee793cb7c2527ad6212c8957b018bcd5278f70c93239d2dd2b8e664f3198beaa96860ce792ea2a32e1448c2dbfadb0b6081a33ee04aa64e01d0a3289867ede3eb54185fd4624664451f41321803bc90319911125a71a43d2858c67f36ab3ece1d1377abc71fec869f033e6e0c82188bf7d27a04d8c0db986a721c9b3185e7a4b440d15edb42c4b6eb1950d0b03cf08d7e301661be67e864c068abff46afe0d4f03b0a6a59060e3008043a0125d24deef6197e4b72b4c750d36a0a177c95f93eac70bb86ec4799aa9911005c81fc437721fa3d719888731e4d84be8ccc448485be31f3d0e5275952b4053be926095ad89d2bcc3b080dff87eb8de106367f4aa641302f2ef0a6dd42ab1dd8cdbeb932093e84f7feed4a3d26e2b775f23626e2abf22ed62210b00cb9701a28bbb7742494e304c5a3c8194b982b2e478b3d2b110bcfef5daea9a343143a2476283e4891c2c5294ba11c9df661a352964163b736f3f23120896bfc6910510c5fd0c253f296c5726f8064536a1e7dcdbbffb03fa9e5e5c75ab19aaaf6a6f50ac0a0c10fc000b71e21b818bba8da3fd10790c857ebc221e0ab6b99cb91dd962e85106909e88600d8fcd689878366a16bd275e69d52abb62b9949673ce2877e2b601d69e76446d0f9db8edc5c906dd75089bba9ce10feec8a0a15a68c3fc7b10fc265c7c0263bf501451750c4f29762dbbdc644e796c5b54a123b28f6bf42c014b8715b210adff2c3274480b3c99c66b64cec3c6fca25c6ac14b68b50b33a3e2b812ec7983aedd188aca673a36b630504f8cd522052028bc4896b8b78453786239493f99c23fce35eaae38c539a97028eb1cafed218673dd07eacd8d1604184271b70dea07c2075497d5a9db937c31ab8bf39a9b1c1fe46099dd7a807a8122707a9c85080e89662d8e5050f91519f358de742138a5216fd13f3544e70c73cc61714b96f1ffba24131e54177c15e69e5f59583af3a79df04f70dbbd2974748f71d4410088a29ab02a11ad2d09fcd9ba69d977d353af3da1e73d98d36195ed5831f9de7d20a0bd8da1dafe7ab90662df3b567b5bdeefa429d03210c8ef0dc83af0d0e8f63444b3a6decba8093e53edde3aee39d67339ea8239b388d81ae0d364d0bef55b1425ba61018ec6d5c45f62d106c4cfead663e681c150762ecf57f41fc1547ce4f949db0129276e92ebba818915e918ecd92deabdc79e7dfa33d322d3d195ea1081474138715c2f55963d4e9cbfbe0e4e8f7d73d2a3b2770d17b282b642f5b88d13a96371fa876f2ef477b7ddc5c9a253f1547c3293f9d68bd0a9343372088594add8bf64af55508238edd7925034545a8e9c148c129a2eacb3cf3f45127ec93f9abdf59229794bd0c7f9979046ef6540821a6c0d1e3d957cc6c4124500a091e52a408e320a150922705bd43b606ad98f36f7f6649491ef8162b96c3041fc2a4d4b03d55912d53ae8bc47580e4c53329b9aa8520558b261fdaca3208742151ed7af6db15dc6e03db5f3d9c37fa207c07dfdf4cafa2ec0f1ea5dd64a597200f5811fc26f20de256f598afd5d519c32775a15835d44cb2d558684732319129e01b41a05210b998d5a3360028da29517280f3a0f3000053d31ac6dcaf9ce61d635b784d9942573eb1c33ab1f4eb10b925ed2d172412744e20ff8811e248a82ed29d1b163a64daa979ed6c25295ae6300b873670e1c86d522577d6a8524bb805c7685e68c159bf291e109e1bf4c035977599eece4e0d27a36493bcb455a98f2e44d7642d5d8759f8155df4186f327c75870e6c842e7e1a42ec6b57468242e4138608da59839e190985513b535433318bd1e092032ab533ef2bf16b79e67ac722c8770a1494665aa1705942e7f3a2c51543dd43138025cc56e546a0f89a2249246d66248b03489c7dbf4aed19ee360635122adc4038ebad252927ad1e3f150f2b1255e20feefeb3187661f62c0937e59b80d79fb5b82b1242ff6f36aed29a8a0f07f75b7a89de5b53c250bbf3032451544d0d721a984d419b9b5dea1773af1e159700187fa7f581a8a2536a26cdd83638cde9cea270785cb13414acd8296ced1fbfeb695824841a7cc6b731b0d06004ffe49d1ec8279217370058bd9669aecb1c0acdb486276f4c2801086838fd84215c28f14f83ea5a24ef4cc68573c3facb17dec1d15a0acfb8f1bd64e2bd2fa51ddd1b442290082271b44053d462d4ddef";
    const publicKey = {
      public_key_limbs: [
        "0x9d9b7ab520532396758488b2100155",
        "0x87ff0f733247ea1ae377d26bdd60aa",
        "0x55e1805ec2babe74ebadb5de3c29a7",
        "0x4131e289b5519e562dff8935a669e2",
        "0xe974f2f0179abc0cc837efb26a9d5d",
        "0x72f158dfb2a2ba0fd881d8742426ec",
        "0x7e56e9182ef83caea0a45cfdaba45a",
        "0xc2b9b23f6684f0442257dbb8a37291",
        "0xfc0ecae4fe9f8be5c52a91edd59db2",
        "0x3ba9bd0376ade89881c7bafa2b36de",
        "0x3548bec7032b97739300f7fd72769b",
        "0x6a5b4b975ccf938c5e63ee41d57c7c",
        "0x4fabc9dbb6a9157f91a87adaff6e66",
        "0x303d705edf9cae022cd91f57f332b6",
        "0x1834cc2b65d9d2cab6dd210ba58cad",
        "0x43b9c3ca0df606d243d4c442794829",
        "0x5239e9f174adc5871d580714b1eb98",
        "0xe1",
      ],
      public_key_redc_limbs: [
        "0x1e7578875458139006e47aac5c17fb",
        "0x249a5affa65fe288cb0df8ab6548be",
        "0xc29ec9b115f3132ff5fb71e744fba3",
        "0xbde4d1e1b2e894dd482277dc14aba5",
        "0x675f382edc2e53fabb2c785f0dd7e8",
        "0x8af86434e50f50ddfc9b46ce2c8990",
        "0xbaf8f36a4caec8a61d14be456599d3",
        "0x4ac14c9865afb8da5ab36b76e6d651",
        "0x2be72e03504024bbc777e0a1e9d16d",
        "0x249a0c4d673705ab5ad1757a225fea",
        "0x0300712f5005899fffeb1289f9ef4b",
        "0x73eb759f585e597acb40bfbf59efed",
        "0xe070a169f35358c7ead1df56d02d4b",
        "0x5657e0c005b6bca107abd9024b4dd1",
        "0xe6da2103c7938911ca44a5e641c541",
        "0xc98e9e1235394e0eb2b87143fd42c3",
        "0xdb1c76abaf095069edf0ea5248ef95",
        "0x0122",
      ],
    };
    const accountId =
      "0x295d04c5c1b26064172f268e6403c1fd1766274e7165ce21684f73b0f76f14b8";
    const account = await new TestJwtAccount__factory(alice).deploy(
      accountId,
      publicKey.public_key_limbs,
      publicKey.public_key_redc_limbs,
      verifier,
    );

    const tx = await account.verify({ proof, jwtIat: 1729186328 });
    const receipt = await tx.wait();
    console.log("gas used", receipt?.gasUsed);
  });
});
